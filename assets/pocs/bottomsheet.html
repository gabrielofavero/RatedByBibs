<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BottomSheet Example</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #f3f3f3;
        }

        .open-btn {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            background: #6200ee;
            color: #fff;
            border: none;
            border-radius: 30px;
            font-size: 16px;
            cursor: pointer;
        }

        .bottomsheet {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            transform: translateY(100%);
            background: #fff;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.2);
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
            transition: transform 0.6s ease-in-out;
            max-height: 80%;
            display: flex;
        }

        .bottomsheet.active {
            transform: translateY(0);
        }

        .sheet-content {
            display: flex;
            flex-direction: column;
            width: 100%;
        }

        .bottomsheet-title {
            padding: 12px 16px;
            flex-shrink: 0;
        }

        .bottomsheet-title {
            padding-top: 8px;
        }

        .drag-handle {
            width: 36px;
            height: 4px;
            background: #d0d0d0;
            border-radius: 999px;
            margin: 8px auto 4px;
            touch-action: none;
            cursor: grab;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            padding: 0 16px;
            overflow-y: auto;
            flex: 1;
        }

        .emoji {
            background: #eee;
            font-size: 28px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
            padding: 12px 0;
        }

        .emoji.selected {
            background: #6200ee;
            color: #fff;
        }

        .bottomsheet-button {
            padding: 12px 16px;
            flex-shrink: 0;
            display: flex;
            justify-content: center;
        }

        .confirm-btn {
            padding: 12px 24px;
            background: #6200ee;
            color: #fff;
            border: none;
            border-radius: 30px;
            font-size: 16px;
            cursor: pointer;
            min-width: 120px;
        }

        .confirm-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>

<body>
    <button class="open-btn">Open Bottomsheet</button>

    <div class="bottomsheet">
        <div class="sheet-content">
            <div class="bottomsheet-title">
                <div class="drag-handle" aria-label="Drag the bottomsheet"></div>
                <h3>Select an Emoji</h3>
            </div>
            <div class="emoji-grid">
                <div class="emoji">üòÄ</div>
                <div class="emoji">üòé</div>
                <div class="emoji">ü•≥</div>
                <div class="emoji">ü§©</div>
                <div class="emoji">üòá</div>
                <div class="emoji">üòÇ</div>
                <div class="emoji">üò°</div>
                <div class="emoji">üòç</div>
                <div class="emoji">ü§î</div>
            </div>
            <div class="bottomsheet-button">
                <button class="confirm-btn" disabled>Confirm</button>
            </div>
        </div>
    </div>

    <script>
        const openBtn = document.querySelector('.open-btn');
        const bottomsheet = document.querySelector('.bottomsheet');
        const emojis = document.querySelectorAll('.emoji');
        const confirmBtn = document.querySelector('.confirm-btn');

        let selectedEmoji = null;

        openBtn.addEventListener('click', () => {
            bottomsheet.classList.add('active');
        });

        emojis.forEach(emoji => {
            emoji.addEventListener('click', () => {
                emojis.forEach(e => e.classList.remove('selected'));
                emoji.classList.add('selected');
                selectedEmoji = emoji.textContent;
                confirmBtn.disabled = false;
            });
        });

        confirmBtn.addEventListener('click', () => {
            console.log("Selected Emoji:", selectedEmoji);
            closeSheet();
            confirmBtn.disabled = true;
            emojis.forEach(e => e.classList.remove('selected'));
            selectedEmoji = null;
        });

        const handle = document.querySelector('.drag-handle');

        let dragging = false;
        let startY = 0;
        let currentY = 0;

        function onDragStart(y) {
            if (!bottomsheet.classList.contains('active')) return;
            dragging = true;
            startY = y;
            bottomsheet.style.transition = 'none';
        }

        function onDragMove(y) {
            if (!dragging) return;
            currentY = Math.max(0, y - startY);
            bottomsheet.style.transform = `translateY(${currentY}px)`;
        }

        function onDragEnd() {
            if (!dragging) return;
            dragging = false;

            const sheetHeight = bottomsheet.getBoundingClientRect().height;
            const threshold = Math.min(0.35 * sheetHeight, 180);

            bottomsheet.style.transition = '';

            if (currentY > threshold) {
                closeSheet(true);
            } else {
                bottomsheet.style.transform = 'translateY(0)';
                const onEnd = () => {
                    bottomsheet.style.transform = '';
                    bottomsheet.removeEventListener('transitionend', onEnd);
                };
                bottomsheet.addEventListener('transitionend', onEnd, { once: true });
            }

            currentY = 0;
        }

        // Mouse events
        handle.addEventListener('mousedown', e => onDragStart(e.clientY));
        window.addEventListener('mousemove', e => onDragMove(e.clientY));
        window.addEventListener('mouseup', onDragEnd);

        // Touch events
        handle.addEventListener('touchstart', e => onDragStart(e.touches[0].clientY), { passive: true });
        window.addEventListener('touchmove', e => {
            if (dragging) e.preventDefault();
            onDragMove(e.touches[0].clientY);
        }, { passive: false });
        window.addEventListener('touchend', onDragEnd);

        function closeSheet(fromDrag = false) {
            if (!bottomsheet.classList.contains('active')) return;

            bottomsheet.style.transition = '';

            if (!fromDrag) {
                bottomsheet.style.transform = 'translateY(0)';
                void bottomsheet.getBoundingClientRect();
            }

            bottomsheet.style.transform = 'translateY(100%)';

            const onEnd = () => {
                bottomsheet.classList.remove('active');
                bottomsheet.style.transform = '';
                bottomsheet.removeEventListener('transitionend', onEnd);
            };
            bottomsheet.addEventListener('transitionend', onEnd, { once: true });
        }

    </script>
</body>

</html>