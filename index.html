<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Rated! By Bibs</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #121212;
      color: #fff;
      text-align: center;
      padding: 2rem;
    }

    #story-container {
      width: 360px;
      height: 640px;
      margin: auto;
      border-radius: 20px;
      background: linear-gradient(to bottom, #1f1f1f, #000);
      padding: 20px;
      box-shadow: 0 0 40px rgba(0, 0, 0, 0.6);
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .game-cover {
      width: 100%;
      height: 60%;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    }

    .rating-section {
      margin-top: 20px;
      font-size: 30px;
    }

    .platform-section {
      font-size: 18px;
      color: #888;
      margin-top: 5px;
    }

    .gaming-id-section {
      font-size: 16px;
      color: #888;
      margin-top: 3px;
    }

    .footer {
      font-size: 14px;
      color: #aaa;
      margin-top: auto;
    }

    .star {
      cursor: pointer;
      font-size: 30px;
      color: #444;
      transition: color 0.2s ease;
    }

    .star.selected {
      color: gold;
    }

    input[type="file"],
    select,
    input[type="text"] {
      margin: 10px 0;
      padding: 5px;
      font-size: 14px;
    }

    button {
      margin: 10px 5px;
      padding: 10px 20px;
      font-size: 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    #preview img {
      max-width: 100%;
      border-radius: 12px;
      margin-top: 10px;
    }

    #star-rating {
      margin-top: 1em;
      margin-bottom: 1em;
    }

    .options {
      margin-bottom: 1em;
    }

    .info-row {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }

    .platform-section img {
      display: block;
    }

    .gaming-id-section {
      display: flex;
      align-items: center;
    }
  </style>
</head>

<body>

  <h1>üéÆ Rated! By Bibs</h1>

  <input type="file" accept="image/*" id="upload" />

  <div id="star-rating">
    <span class="star" data-value="1">‚òÖ</span>
    <span class="star" data-value="2">‚òÖ</span>
    <span class="star" data-value="3">‚òÖ</span>
    <span class="star" data-value="4">‚òÖ</span>
    <span class="star" data-value="5">‚òÖ</span>
  </div>

  <div class="options">
    <select id="platform-select">
      <option value="">Select Platform</option>
      <option value="xbox">Xbox</option>
      <option value="switch2">Nintendo Switch 2</option>
      <option value="switch">Nintendo Switch</option>
      <option value="steam">Steam</option>
      <option value="playstation">Playstation</option>
    </select>

    <input type="text" id="gaming-id" placeholder="Gaming ID (optional)" />
  </div>

  <button onclick="generateStory()">üì∏ Generate Story</button>
  <button onclick="downloadStory()">‚¨áÔ∏è Download</button>
  <button onclick="shareStory()">üì≤ Share</button>

  <div id="preview"></div>

  <div id="story-container" style="display: none;">
    <div class="game-cover" id="game-cover"></div>
    <div class="rating-section" id="rating-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
    <div class="info-row">
      <div class="platform-section" id="platform-display"></div>
      <div class="gaming-id-section" id="gaming-id-display"></div>
    </div>
    <div class="footer">Rated with RatedByBibs</div>
  </div>

  <script>
    let selectedStars = 0;
    let uploadedImage = null;
    let generatedImageData = '';

    document.getElementById('platform-select').value = localStorage.getItem('selectedPlatform') || '';
    document.getElementById('gaming-id').value = localStorage.getItem('gamingId') || '';

    document.getElementById('platform-select').addEventListener('change', (e) => {
      localStorage.setItem('selectedPlatform', e.target.value);
      updateInputPlaceholder(e.target.value);
    });

    document.getElementById('gaming-id').addEventListener('input', (e) => {
      localStorage.setItem('gamingId', e.target.value);
    });

    function updateInputPlaceholder(platform) {
      let placeholder;

      switch (platform) {
        case 'xbox':
          placeholder = 'Gamertag';
          break;
        case 'switch':
        case 'switch2':
          placeholder = 'Nintendo Account';
          break;
        case 'steam':
          placeholder = 'Steam ID';
          break;
        case 'playstation':
          placeholder = 'PSN ID';
          break;
        default:
          placeholder = 'Gaming ID';
      }

      const gamingIdInput = document.getElementById('gaming-id');
      if (gamingIdInput) {
        gamingIdInput.placeholder = `${placeholder} (optional)`;
      }
    }

    const stars = document.querySelectorAll('.star');
    stars.forEach(star => {
      star.addEventListener('click', () => {
        selectedStars = parseInt(star.dataset.value);
        updateStarDisplay();
      });
    });

    function updateStarDisplay() {
      stars.forEach(star => {
        const val = parseInt(star.dataset.value);
        star.classList.toggle('selected', val <= selectedStars);
      });
    }

    document.getElementById('upload').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (event) {
        uploadedImage = event.target.result;
        document.getElementById('game-cover').style.backgroundImage = `url(${uploadedImage})`;
      };
      reader.readAsDataURL(file);
    });

    async function generateStory() {
      if (!uploadedImage || selectedStars === 0) {
        alert("Please upload an image and select a star rating.");
        return;
      }

      const rating = '‚òÖ'.repeat(selectedStars) + '‚òÜ'.repeat(5 - selectedStars);
      document.getElementById('rating-stars').textContent = rating;

      const gamingId = document.getElementById('gaming-id').value.trim();
      document.getElementById('gaming-id-display').textContent = gamingId ? gamingId : '';

      const platform = document.getElementById('platform-select').value;
      if (platform) {
        const platformIcon = document.createElement('img');
        platformIcon.src = `icons/${platform}.png`;
        platformIcon.style.height = '20px';
        document.getElementById('platform-display').innerHTML = '';
        document.getElementById('platform-display').appendChild(platformIcon);
      }

      const story = document.getElementById('story-container');
      story.style.display = 'flex';

      const canvas = await html2canvas(story, { backgroundColor: null });
      const dataUrl = canvas.toDataURL('image/png');
      generatedImageData = dataUrl;

      const img = document.createElement('img');
      img.src = dataUrl;
      const preview = document.getElementById('preview');
      preview.innerHTML = '<h3>Preview:</h3>';
      preview.appendChild(img);

      story.style.display = 'none';
    }

    async function downloadStory() {
      if (!generatedImageData) {
        await generateStory();
      }
      const a = document.createElement('a');
      a.href = generatedImageData;
      a.download = 'game-story.png';
      a.click();
    }

    async function shareStory() {
      if (!generatedImageData) {
        await generateStory();
      }

      const res = await fetch(generatedImageData);
      const blob = await res.blob();
      const file = new File([blob], 'game-story.png', { type: 'image/png' });

      if (navigator.canShare && navigator.canShare({ files: [file] })) {
        try {
          await navigator.share({
            files: [file],
            title: 'My Game Rating',
            text: `I rated a game ${selectedStars}/5 on ${document.getElementById('platform-select').value}! üéÆ`
          });
        } catch (err) {
          alert("Sharing failed: " + err.message);
        }
      } else {
        alert("Sharing not supported on this browser/device.");
      }
    }

  </script>

</body>

</html>